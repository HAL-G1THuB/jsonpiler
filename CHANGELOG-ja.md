# プロジェクトの歴史と計画

## 計画

- ループの実装
- 入出力関数を増やす
- 文字列操作関数を増やす
- ヒープ領域にデータを格納できるようにする
- スコープ終了時にヒープを解放できるようにする
- 代入のあいまいさを排除し、所有権システムを構築する

## リリース済み

### jsonpiler 0.4

### 0.4.2

- 新しい関数`concat`が追加された。この関数は文字列リテラル同士をリテラルを保ちながら結合するために使用される。
- Objectを3つの亜種に分割。
- **HashMap**: キーと値のペアのコレクションを表す。
- **Sequence**: 命令の順序付けられたシーケンスを表す。
- **TypeAnnotations**: 変数または関数の型アノテーションを表す。
- 四則演算関数の引数を与えない場合、エラーが出るようになった。
- `lambda`の引数を実装。
- `lambda`の返り値にできる型が豊富になった。
- `+`, `/`, `*`, `or`, `and`, `xor`の最低限の引数の数が2になった。
- `message`の返り値が`Null`になった。

### 0.4.1

- 入力ファイルを1GB以下に制限したため、不要となったパーサー内のセーフティーチェックを排除し、高速化。
- アセンブリ命令の保存方法を変え、処理速度とメモリ効率を改善。
- cの関数(malloc, free)への依存をなくしたことにより、`ucrtbase.dll`が不要となった。
- 組み込み関数のドキュメントが肥大化したため、複数のファイルに分割した。
- 変数に束縛されていない関数の引数として渡された一時的な値が解放されるタイミングが、その関数が終了したときに定まった。(例外として、`if`の本体の最後の一時的な値は解放される)
- `if`, `scope`,`lambda`の引数の形式が変更された。
- 新しい関数`value`が追加された。この関数は与えられた評価済みの値をそのまま返し、Objectの命令列の最後にリテラルを追加するために使用される。

#### 0.4.0

- 新しい関数を追加: `not`, `xor`, `or`, `and`
- 組み込み関数が肥大化したため、複数のファイルに分割した。
- 命令の肥大化による性能低下が予想されるため、bool型のメモリ領域を1bitから1byteに変更。
- 関数の引数検証を直感的に。

### jsonpiler 0.3

#### 0.3.5

- `if` 関数の実装
- バージョン0.1.6でdocs.rsドキュメントが生成されないことがあった問題を修正し、代替ドキュメントを削除した。
- 生成されたアセンブリの命令列周りの空白文字をタブに変更。
- 内容が希薄なドキュメンテーションコメントを削除。
- 変更履歴とREADMEに日本語版を追加。

#### 0.3.4

- `bool` 型の代入をサポート。
- より保守しやすく体系的な方法でアセンブリ命令とラベルを生成するようにコードをリファクタリング。

#### 0.3.3

- スコープベースのロジックを処理する際にスタックからメモリが正しく解放されないバグを修正。
- スコープ`関数が第一引数を無視する状況を修正。
- 冗長な安全性チェックを削除。

#### 0.3.2

- `Float`型を代入できるようになりました。
- 関数定義がグローバルスコープのみを明示的に共有するようになりました。
- `global`関数のバグを修正。

#### 0.3.1

- 新しい関数 `/`, `abs`, `%` を追加。

#### 0.3.0

- Json オブジェクトがキーの重複を許容するようになりました。
- オブジェクトは関数呼び出しとして扱われるようになりました:  
  JSON オブジェクトの各キーは関数名として解釈され、対応する値は関数の引数として扱われます。
- すでに組み込み関数として存在する変数名に、ユーザー定義関数を代入することはできなくなりました。
- 配列は全ての要素の評価結果を残すようになりました:  
- 複数のキー関数のエントリーをサポート:  
  オブジェクトに複数のキーが含まれる場合、それぞれが順番に評価され、最後の関数の結果が返されます。
- 引数が配列でない場合、角括弧を省略できるようになりました。
- オブジェクトの列で表現できるようになったため、`begin`関数が削除されました。

### jsonpiler 0.2

#### 0.2.3

- 次のバージョンアップに向けて、ソースコードのリファクタリングとクリーンアップを。
- ~~オブジェクト・キーの重複が許されなくなりました。~~
- 効率的なスタック解放を可能にするために一時的な値のトラッキングを追加し、変数バインディングを除いてスタックの無駄を最小限に。
- pos.size`を使用して、エラー範囲全体にわたる^マーカーを表示するように、エラーの書式を改善。

#### 0.2.2

- `examples`ディレクトリを追加。
- ~~組み込み関数がユーザー定義関数より優先されるようになった。~~
- ~~ユーザー定義関数を優先するには `["$", "function"]` と記述してください。~~
- スタックの空き領域を効率的に保存し、必要に応じてその領域を埋める機能を追加。
- 単項 `-` が引数1つを渡された場合、符号を反転するようになりました。

#### 0.2.1

- ローカル変数がスタックに格納されるようになりました。
- 32 ビット以上のリテラルをオペランドとして受け取る `+`, `-`, `*` の場合にアセンブラが失敗する問題を修正。
- スコープの開始時にスタックを確保し、終了時にスタックを解放する機能を追加。

#### 0.2.0

- `begin`の代わりに、新しい `scope` 関数がスコープを処理。
- 新しい関数を追加： scope`、`*`、`list`、`'`。

### jsonpiler 0.1

#### 0.1.11

- 文字列リテラルのキャッシュと再利用を追加。
- アセンブリ・コードの変数生成を一般化。
- 内部構造体の名前を大幅に変更し、わかりやすさを向上。

#### 0.1.10

- 前バージョンからの不具合を修正し、パーサーのパフォーマンスを大幅に改善。

#### 0.1.9

- スタック割り当てを動的に変更する機能を追加。
- エラーメッセージのフォーマットを修正。
- ~~パーサーのオーバーヘッドを削減。~~

#### 0.1.8

- 新しい関数 `global` を追加。
- 変数テーブルの構造を変更。
- ~~`begin`がスコープを導入するようになりました。~~

#### 0.1.7

- メイン関数が `!` の代わりに `ExitCode` を返すようになりました。
- 自動保存とリストアによる一時的なレジスタ保存を実装。
- 内部関数は必要なときだけバイナリに含まれるようになりました。

#### 0.1.6

- 関数 `=` が `null` を返すようになりました。
- docs.rs のドキュメントのビルドエラーを修正しまし。
- より多くの型の値に代入できるように `$` 演算子を強化。

#### 0.1.5

- プロジェクトの更新を追跡するために `CHANGELOG.md` を追加。

#### 0.1.4

- 以前のクレートのタイプミスを修正。

#### 0.1.3

- オブジェクトのエントリが挿入順を保持するようになりました。
- オブジェクト値の評価が挿入順序に従うようになりました。

#### 0.1.2

- `README.md` にMermaid図を追加。
- 式の評価順序に影響するバグを修正。

#### 0.1.0 ~ 0.1.1

- 以前のクレートから移行。
