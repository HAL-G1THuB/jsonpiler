# プロジェクトの歴史と計画

## 計画

- 文字列操作関数を増やす
- ヒープ領域にデータを格納できるようにする
- スコープ終了時にヒープを解放できるようにする

## リリース済み

### jsonpiler 0.6

#### 0.6.4

- ユーザー定義関数の第五引数以降が正しく認識されない問題を修正

#### 0.6.3

- 四則演算`+`, `-`, `*`, `/`がFloat型をサポート
- Float型を整数に切り捨てる関数を追加: `Int`
- I/O関数を追加: `print`
- global関数のエラーを修正

#### 0.6.2

- ユーザー定義関数にbool値が正しく渡されていない問題を修正
- ローカル変数に格納された文字列が正しく認識されない問題を修正
- ユーザー定義関数の最大引数を16に設定
- Jsonpilerが正しいexeの終了コードを返すようになった。
- 新しい関数を追加: `len`

#### 0.6.1

- JSPL の導入:JSPL (Jsonpiler Structured Programming Language)は、人間にとって書きやすく読みやすい記述を可能にするために導入された、Jsonpiler の新しい構文です。
- 言語仕様に日本語版を追加。

#### 0.6.0

- ループ構造の実装: `while`
- アセンブラの組み込みにより発生したエスケープ文字が正しく表示されない問題の修正
- ローカル変数への再代入がほとんどの型で使用可能になった。
- 新しい関数 `==`, `<`, `<=` を追加。
- `lambda`を廃止し、代わりに関数の登録や、再帰呼び出しを備えた`define`を追加
- `Function`型の廃止。

### jsonpiler 0.5

#### 0.5.3 ~ 0.5.4

- 0.5.0 の重大なバグを修正

#### 0.5.1 ~ 0.5.2

.gitattributes に\*.bin binary を追加

#### 0.5.0

- 一部の mov 命令に 32bit 以上の値を入れるとアセンブラがエラーを起こす問題を修正。
- **jsonpiler 内にアセンブラ兼リンカを実装し、GNU as と GNU ld が不要になった。**
- 一時的に生成、消去されていた.s ファイル、.obj ファイルが生成されなくなった。
- 一時的に SEH を消去

### jsonpiler 0.4

#### 0.4.2

- 新しい関数`concat`が追加された。この関数は文字列リテラル同士をリテラルを保ちながら結合するために使用される。
- Object を 3 つの亜種に分割。
- **HashMap**: キーと値のペアのコレクションを表す。
- **Sequence**: 命令の順序付けられたシーケンスを表す。
- **TypeAnnotations**: 変数または関数の型アノテーションを表す。
- 四則演算関数の引数を与えない場合、エラーが出るようになった。
- `lambda`の引数を実装。
- `lambda`の返り値にできる型が豊富になった。
- `+`, `/`, `*`, `or`, `and`, `xor`の最低限の引数の数が 2 になった。
- `message`の返り値が`Null`になった。

#### 0.4.1

- 入力ファイルを 1GB 以下に制限したため、不要となったパーサー内のセーフティーチェックを排除し、高速化。
- アセンブリ命令の保存方法を変え、処理速度とメモリ効率を改善。
- c の関数(malloc, free)への依存をなくしたことにより、`ucrtbase.dll`が不要となった。
- 組み込み関数のドキュメントが肥大化したため、複数のファイルに分割した。
- 変数に束縛されていない関数の引数として渡された一時的な値が解放されるタイミングが、その関数が終了したときに定まった。(例外として、`if`の本体の最後の一時的な値は解放される)
- `if`, `scope`,`lambda`の引数の形式が変更された。
- 新しい関数`value`が追加された。この関数は`Object`の命令列の最後にリテラルを追加するために使用される。

#### 0.4.0

- 新しい関数を追加: `not`, `xor`, `or`, `and`
- 組み込み関数が肥大化したため、複数のファイルに分割した。
- 命令の肥大化による性能低下が予想されるため、bool 型のメモリ領域を 1bit から 1byte に変更。
- 関数の引数検証を直感的に。

### jsonpiler 0.3

#### 0.3.5

- `if` 関数の実装
- 0.1.6 で docs.rs ドキュメントが生成されないことがあった問題を修正したため、代替ドキュメントを削除した。
- 生成されたアセンブリの命令列周りの空白文字をタブに変更。
- 内容が希薄なドキュメンテーションコメントを削除。
- 変更履歴と README に日本語版を追加。

#### 0.3.4

- `bool` 型の代入をサポート。
- より保守しやすく体系的な方法でアセンブリ命令とラベルを生成するようにコードをリファクタリング。

#### 0.3.3

- スコープベースのロジックを処理する際にスタックからメモリが正しく解放されないバグを修正。
- スコープ`関数が第一引数を無視する状況を修正。
- 冗長な安全性チェックを削除。

#### 0.3.2

- `Float`型を代入できるようになりました。
- 関数定義がグローバルスコープのみを明示的に共有するようになりました。
- `global`関数のバグを修正。

#### 0.3.1

- 新しい関数 `/`, `abs`, `%` を追加。

#### 0.3.0

- Json オブジェクトがキーの重複を許容するようになりました。
- オブジェクトは関数呼び出しとして扱われるようになりました:  
  JSON オブジェクトの各キーは関数名として解釈され、対応する値は関数の引数として扱われます。
- すでに組み込み関数として存在する変数名に、ユーザー定義関数を代入することはできなくなりました。
- 配列は全ての要素の評価結果を残すようになりました:
- 複数のキー関数のエントリーをサポート:  
  オブジェクトに複数のキーが含まれる場合、それぞれが順番に評価され、最後の関数の結果が返されます。
- 引数が配列でない場合、角括弧を省略できるようになりました。
- オブジェクトの列で表現できるようになったため、`begin`関数が削除されました。

### jsonpiler 0.2

#### 0.2.3

- 次のバージョンアップに向けて、ソースコードをリファクタリング。
- ~~オブジェクト・キーの重複が許されなくなりました。~~
- 効率的なスタック解放を可能にするために一時的な値のトラッキングを追加し、スタックの無駄を最小限に。
- pos.size`を使用して、エラー範囲全体にわたる^マーカーを表示するように、エラーの書式を改善。

#### 0.2.2

- `examples`ディレクトリを追加。
- ~~組み込み関数がユーザー定義関数より優先されるようになった。~~
- ~~ユーザー定義関数を優先するには `["$", "function"]` と記述してください。~~
- スタックの空き領域を効率的に保存し、必要に応じてその領域を埋める機能を追加。
- 単項 `-` が引数 1 つを渡された場合、符号を反転するようになりました。

#### 0.2.1

- ローカル変数がスタックに格納されるようになりました。
- 32 ビット以上のリテラルをオペランドとして受け取る `+`, `-`, `*` の場合にアセンブラが失敗する問題を修正。
- スコープの開始時にスタックを確保し、終了時にスタックを解放する機能を追加。

#### 0.2.0

- `begin`の代わりに、新しい `scope` 関数がスコープを処理。
- 新しい関数を追加： scope`、`\*`、`list`、`'`。

### jsonpiler 0.1

#### 0.1.11

- 文字列リテラルのキャッシュと再利用を追加。
- アセンブリ・コードの変数生成を一般化。
- 内部構造体の名前を大幅に変更し、わかりやすさを向上。

#### 0.1.10

- 前バージョンからの不具合を修正し、パーサーのパフォーマンスを大幅に改善。

#### 0.1.9

- スタック割り当てを動的に変更する機能を追加。
- エラーメッセージのフォーマットを修正。
- ~~パーサーのオーバーヘッドを削減。~~

#### 0.1.8

- 新しい関数 `global` を追加。
- 変数テーブルの構造を変更。
- ~~`begin`がスコープを導入するようになりました。~~

#### 0.1.7

- ~~メイン関数が `!` の代わりに `ExitCode` を返すようになりました。~~
- 自動保存とリストアによる一時的なレジスタ保存を実装。
- 内部関数は必要なときだけバイナリに含まれるようになりました。

#### 0.1.6

- 関数 `=` が `null` を返すようになりました。
- docs.rs のドキュメントのビルドエラーを修正しまし。
- より多くの型の値に代入できるように `$` 演算子を強化。

#### 0.1.5

- プロジェクトの更新を追跡するために `CHANGELOG.md` を追加。

#### 0.1.4

- 以前のクレートのタイプミスを修正。

#### 0.1.3

- オブジェクトのエントリが挿入順を保持するようになりました。
- オブジェクト値の評価が挿入順序に従うようになりました。

#### 0.1.2

- `README.md` に Mermaid 図を追加。
- 式の評価順序に影響するバグを修正。

#### 0.1.0 ~ 0.1.1

- 以前のクレートから移行。
